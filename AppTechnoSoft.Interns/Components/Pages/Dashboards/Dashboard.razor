@page "/dashboard"
@using AppTechnoSoft.Interns.Components.Account
@using Microsoft.AspNetCore.Identity

@attribute [Authorize]
@inject ApplicationDbContext Db

<PageTitle>Dashboards</PageTitle>

<MudTabs Outlined>
    @if (loggedInUserRoles.Contains(Role.Instructor))
    {
        <MudTabPanel Text="Instructor Dashboard" Icon="@Icons.Material.Filled.PersonPin">
            <InstructorDash LoggedInUserId="@loggedInUserId" />
        </MudTabPanel>
    }

    @if (loggedInUserRoles.Contains(Role.Admin) || loggedInUserRoles.Contains(Role.SuperAdmin))
    {
        <MudTabPanel Text="Admin Dashboard" Icon="@Icons.Material.Filled.DisplaySettings">
            <AdminDash />
        </MudTabPanel>
    }
</MudTabs>

@code {

    string loggedInUserId = string.Empty;

    [CascadingParameter]
    private Task<AuthenticationState> AuthTask { get; set; } = null!;

    private IEnumerable<string> loggedInUserRoles = [];

    protected override async Task OnInitializedAsync()
    {
        var userTask = await AuthTask;
        var loggedInUser = userTask.User;
        loggedInUserId = loggedInUser.GetUserId();
        loggedInUserRoles = loggedInUser.GetRoles();
    }
}
